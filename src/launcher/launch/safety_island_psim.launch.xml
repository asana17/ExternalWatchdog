<?xml version="1.0" encoding="UTF-8"?>
<launch>

  <arg name="hazard_status_converter_config_file" default="$(find-pkg-share hazard_status_converter)/config/hazard_status_converter.param.yaml" />
  <!-- hazard_status from autoware system_error_monitor -->
  <arg name="main_self_system_emergency_hazard_status" default="/system/emergency/hazard_status"/>

  <!-- self monitoring -->
  <arg name="main_self_hazard_status" default="/main/self_monitoring/hazard_status"/>
  <arg name="sub_self_hazard_status" default="/sub/self_monitoring/hazard_status"/>
  <arg name="supervisor_self_hazard_status" default="/supervisor/self_monitoring/hazard_status"/>
  <!-- external monitoring: /<monitoring ECU>/external_monitoring/hazard_status/<monitored ecu>-->
  <arg name="main_external_hazard_status_sub" default="/main/external_monitoring/hazard_status/sub"/>
  <arg name="main_external_hazard_status_supervisor" default="/main/external_monitoring/hazard_status/supervisor"/>
  <arg name="sub_external_hazard_status_main" default="/sub/external_monitoring/hazard_status/main"/>
  <arg name="sub_external_hazard_status_supervisor" default="/sub/external_monitoring/hazard_status/supervisor"/>
  <arg name="supervisor_external_hazard_status_main" default="/supervisor/external_monitoring/hazard_status/main"/>
  <arg name="supervisor_external_hazard_status_sub" default="/supervisor/external_monitoring/hazard_status/sub"/>
  <!-- mrm status -->
  <arg name="main_mrm_comfortable_stop_status" default="/system/mrm/comfortable_stop/status"/>
  <arg name="sub_mrm_comfortable_stop_status" default="/sub/mrm/comfortable_stop/status"/>
  <arg name="main_mrm_emergency_stop_status" default="/system/mrm/emergency_stop/status"/>
  <arg name="sub_mrm_emergency_stop_status" default="/sub/mrm/emergency_stop/status"/>
  <arg name="supervisor_mrm_emergency_stop_status" default="/supervisor/mrm/emergency_stop/status"/>


  <!-- supervisor -->
  <include file="$(find-pkg-share supervisor_psim)/launch/supervisor_psim_node.launch.xml" >
    <arg name="main_self_hazard_status" value="$(var main_self_hazard_status)"/>
    <arg name="sub_self_hazard_status" value="$(var sub_self_hazard_status)"/>
    <arg name="supervisor_self_hazard_status" value="$(var supervisor_self_hazard_status)"/>

    <arg name="main_external_hazard_status_sub" value="$(var main_external_hazard_status_sub)"/>
    <arg name="main_external_hazard_status_supervisor" value="$(var main_external_hazard_status_supervisor)"/>
    <arg name="sub_external_hazard_status_main" value="$(var sub_external_hazard_status_main)"/>
    <arg name="sub_external_hazard_status_supervisor" value="$(var sub_external_hazard_status_supervisor)"/>
    <arg name="supervisor_external_hazard_status_main" value="$(var supervisor_external_hazard_status_main)"/>
    <arg name="supervisor_external_hazard_status_sub" value="$(var supervisor_external_hazard_status_sub)"/>
    <arg name="main_mrm_comfortable_stop_status" value="$(var main_mrm_comfortable_stop_status)"/>
    <arg name="sub_mrm_comfortable_stop_status" value="$(var sub_mrm_comfortable_stop_status)"/>
    <arg name="main_mrm_emergency_stop_status" value="$(var main_mrm_emergency_stop_status)"/>
    <arg name="sub_mrm_emergency_stop_status" value="$(var sub_mrm_emergency_stop_status)"/>
    <arg name="supervisor_mrm_emergency_stop_status" value="$(var supervisor_mrm_emergency_stop_status)"/>
  </include>

  <!-- emergency_stop_operator -->
  <include file="$(find-pkg-share emergency_stop_operator)/launch/emergency_stop_operator.launch.xml" />

  <!-- hazard_status_converter -->
  <include file="$(find-pkg-share hazard_status_converter)/launch/hazard_status_converter.launch.xml">
    <arg name="config_file" value="$(var hazard_status_converter_config_file)"/>
    <arg name="input_hazard_status" value="$(var main_self_system_emergency_hazard_status)"/>
    <arg name="hazard_status" value="$(var main_self_hazard_status)"/>
  </include>

  <!-- dummy_hazard_status_publisher -->
  <node_container pkg="rclcpp_components" exec="component_container" name="dummy_hazard_status_publisher_container" namespace="">
    <composable_node pkg="dummy_hazard_status_publisher" plugin="dummy_hazard_status_publisher::DummyHazardStatusPublisher" name="dummy_hazard_status_publisher" namespace="sub_self_monitoring">
      <param name="hazard_status" value="$(var sub_self_hazard_status)"/>
    </composable_node>
    <composable_node pkg="dummy_hazard_status_publisher" plugin="dummy_hazard_status_publisher::DummyHazardStatusPublisher" name="dummy_hazard_status_publisher" namespace="supervisor_self_monitoring">
      <param name="hazard_status" value="$(var supervisor_self_hazard_status)"/>
    </composable_node>
    <composable_node pkg="dummy_hazard_status_publisher" plugin="dummy_hazard_status_publisher::DummyHazardStatusPublisher" name="dummy_hazard_status_publisher" namespace="main_external_monitoring_sub">
      <param name="hazard_status" value="$(var main_external_hazard_status_sub)"/>
    </composable_node>
    <composable_node pkg="dummy_hazard_status_publisher" plugin="dummy_hazard_status_publisher::DummyHazardStatusPublisher" name="dummy_hazard_status_publisher" namespace="main_external_monitoring_supervisor">
      <param name="hazard_status" value="$(var main_external_hazard_status_supervisor)"/>
    </composable_node>
    <composable_node pkg="dummy_hazard_status_publisher" plugin="dummy_hazard_status_publisher::DummyHazardStatusPublisher" name="dummy_hazard_status_publisher" namespace="sub_external_monitoring_main">
      <param name="hazard_status" value="$(var sub_external_hazard_status_main)"/>
    </composable_node>
    <composable_node pkg="dummy_hazard_status_publisher" plugin="dummy_hazard_status_publisher::DummyHazardStatusPublisher" name="dummy_hazard_status_publisher" namespace="sub_external_monitoring_supervisor">
      <param name="hazard_status" value="$(var sub_external_hazard_status_supervisor)"/>
    </composable_node>
    <composable_node pkg="dummy_hazard_status_publisher" plugin="dummy_hazard_status_publisher::DummyHazardStatusPublisher" name="dummy_hazard_status_publisher" namespace="supervisor_external_monitoring_main">
      <param name="hazard_status" value="$(var supervisor_external_hazard_status_main)"/>
    </composable_node>
    <composable_node pkg="dummy_hazard_status_publisher" plugin="dummy_hazard_status_publisher::DummyHazardStatusPublisher" name="dummy_hazard_status_publisher" namespace="supervisor_external_monitoring_sub">
      <param name="hazard_status" value="$(var supervisor_external_hazard_status_sub)"/>
    </composable_node>
  </node_container>

</launch>
